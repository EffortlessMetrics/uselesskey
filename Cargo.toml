[workspace]
resolver = "2"
members = [
  "crates/uselesskey-test-grid",
  "crates/uselesskey-feature-grid",
  "crates/uselesskey",
  "crates/uselesskey-core",
  "crates/uselesskey-core-id",
  "crates/uselesskey-core-kid",
  "crates/uselesskey-core-keypair",
  "crates/uselesskey-core-negative",
  "crates/uselesskey-core-sink",
  "crates/uselesskey-jwk",
  "crates/uselesskey-rsa",
  "crates/uselesskey-ecdsa",
  "crates/uselesskey-ed25519",
  "crates/uselesskey-hmac",
  "crates/uselesskey-token",
  "crates/uselesskey-pgp",
  "crates/uselesskey-x509",
  "crates/uselesskey-jsonwebtoken",
  "crates/uselesskey-rustls",
  "crates/uselesskey-tonic",
  "crates/uselesskey-ring",
  "crates/uselesskey-rustcrypto",
  "crates/uselesskey-aws-lc-rs",
  "crates/uselesskey-interop-tests",
  "crates/uselesskey-bdd",
  "crates/uselesskey-bdd-steps",
  "tests",
  "xtask",
]
exclude = ["fuzz"]

[workspace.package]
edition = "2024"
license = "MIT OR Apache-2.0"
rust-version = "1.92"
repository = "https://github.com/EffortlessMetrics/uselesskey"
authors = ["Effortless Metrics <opensource@effortlessmetrics.com>"]

[workspace.dependencies]
# error handling
thiserror = "2.0.18"

uselesskey-test-grid = { path = "crates/uselesskey-test-grid", version = "0.3.0" }
uselesskey-feature-grid = { path = "crates/uselesskey-feature-grid", version = "0.3.0" }
uselesskey-core-id = { path = "crates/uselesskey-core-id", version = "0.3.0", default-features = false }
uselesskey-core-kid = { path = "crates/uselesskey-core-kid", version = "0.3.0" }
uselesskey-core-keypair = { path = "crates/uselesskey-core-keypair", version = "0.3.0" }
uselesskey-core-negative = { path = "crates/uselesskey-core-negative", version = "0.3.0", default-features = false }

# determinism / hashing
blake3 = "1.8.3"

# concurrency-friendly cache
dashmap = "6.1.0"

# RNG â€” pinned to 0.6/0.3: rsa 0.9 and ed25519-dalek 2 require rand_core 0.6
rand_core = "0.6.4"
rand_chacha = "0.3.1"

# sinks
tempfile = "3.24.0"
uselesskey-core-sink = { path = "crates/uselesskey-core-sink", version = "0.3.0" }

# testing
proptest = "1.10.0"
rstest = "0.26.1"

# CLI helpers (xtask)
anyhow = "1.0.101"
clap = { version = "4.5.57", features = ["derive"] }

# BDD
cucumber = { version = "0.22.1", features = ["macros"] }
tokio = { version = "1.49.0", features = ["macros", "rt-multi-thread"] }

# RSA
rsa = { version = "0.9.10", features = ["pem"] }

# Ed25519
ed25519-dalek = { version = "2.2.0", features = ["pkcs8", "pem", "rand_core"] }
pkcs8 = { version = "0.10.2", features = ["pem"] }

# optional JWK helpers
serde = { version = "1.0.228", features = ["derive"] }
serde_json = "1.0.149"
base64 = "0.22.1"

# JWT
jsonwebtoken = { version = "10", features = ["use_pem", "rust_crypto"] }

# TLS
rustls = { version = "0.23", default-features = false, features = ["std", "tls12", "ring"] }
rustls-pki-types = "1"

# Crypto backends
aws-lc-rs = { version = "1", default-features = false, features = ["alloc", "non-fips"] }
ring = { version = "0.17", default-features = false, features = ["std"] }

[profile.dev]
# RSA keygen can be slow in debug; opt-level 2 keeps BDD/RSA tests from looking hung.
opt-level = 2

[profile.test]
opt-level = 2
